@model SiteEventsPageViewModel
@{
    ViewData["Title"] = "Events";
}

<h2 class="mb-4 border-bottom pb-2">@Model.SiteName - Event Review</h2>

<div class="row">
    <partial name="_SummaryStatCard" model='("Total Events", Model.TotalEvents.ToString())' />
    <partial name="_SummaryStatCard" model='("Avg Validity Score", Model.AverageValidityScore.ToString("0.0"))' />
    <partial name="_SummaryStatCard" model='("# Low Confidence", Model.LowConfidenceCount.ToString())' />
    <partial name="_SummaryStatCard" model='("# Distance Deviations", Model.DistanceDeviationCount.ToString())' />
</div>

<div class="card shadow-sm mb-4">
    <div class="card-header fw-semibold bg-light">Filters</div>
    <div class="card-body">
        <form method="get" asp-controller="Sites" asp-action="Events" asp-route-id="@Model.SiteId" class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="form-label">Confidence Level</label>
                <select class="form-select" name="confidence">
                    @foreach (var option in new[] { "All", "High", "Medium", "Low" })
                    {
                        <option value="@option" selected="@(option == Model.SelectedConfidence)">@option</option>
                    }
                </select>
            </div>
            <div class="col-md-3">
                <div class="form-check mt-4">
                    <input class="form-check-input" type="checkbox" name="flaggedOnly" value="true" id="flaggedOnly" checked="@Model.ShowOnlyFlagged" />
                    <label class="form-check-label" for="flaggedOnly">Show only flagged</label>
                </div>
            </div>
            <div class="col-md-3">
                <button class="btn btn-primary" type="submit">Apply Filter</button>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm mb-4">
    <div class="card-header fw-semibold bg-light">Event List</div>
    <div class="card-body p-0">
        <table class="table table-striped table-hover align-middle mb-0">
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>Monitor ID</th>
                    <th>Î”t (ms)</th>
                    <th>Estimated Distance (m)</th>
                    <th>Validity Score</th>
                    <th>Confidence</th>
                    <th>Flags</th>
                    <th class="text-end">Action</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var item in Model.Events)
            {
                <tr>
                    <td>@item.TimestampUtc.ToString("yyyy-MM-dd HH:mm:ss")</td>
                    <td>@item.MonitorId</td>
                    <td>@item.DeltaTMilliseconds.ToString("0.0")</td>
                    <td>@item.EstimatedDistanceMeters.ToString("0.0")</td>
                    <td>@item.ValidityScore.ToString("0.0")</td>
                    <td><partial name="_StatusBadge" model="item.Confidence" /></td>
                    <td>
                        @if (item.DistanceDeviationFlag)
                        {
                            <span class="badge bg-primary me-1">Distance Deviation</span>
                        }
                        @if (item.HealthWarningFlag)
                        {
                            <span class="badge bg-warning text-dark">Health Warning</span>
                        }
                    </td>
                    <td class="text-end">
                        <a class="btn btn-outline-secondary btn-sm" asp-controller="Events" asp-action="Details" asp-route-id="@item.Id">View</a>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>
